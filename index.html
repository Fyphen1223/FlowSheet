<!DOCTYPE html>
<html lang="ja">
  <head>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NWV7XMCM');</script>
<!-- End Google Tag Manager -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#3b5998" />
    <title>ディベート・フローシート</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="shortcut icon" href="icons/icon-192.png" type="image/x-icon" />
    <link rel="manifest" href="manifest.webmanifest" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>フローシート</h1>
        <div style="text-align: right; margin: 0 2vw 10px 0">
          <button id="export-flow-menu-btn" class="download-btn">
            出力: フロー
          </button>
          <button
            id="export-score-menu-btn"
            class="download-btn"
            style="margin-left: 8px"
          >
            出力: スコア/印刷
          </button>
          <button
            id="clear-flow-btn"
            class="download-btn"
            style="background: #c0392b; margin-left: 8px"
          >
            フローを全削除
          </button>
          <button
            id="export-dfsf-btn"
            class="download-btn"
            style="margin-left: 8px"
          >
            フローを保存(.dfsf)
          </button>
          <button
            id="import-dfsf-btn"
            class="download-btn"
            style="margin-left: 8px; background: #16a085"
          >
            読み込み(.dfsf)
          </button>
          <button
            id="share-link-btn"
            class="download-btn"
            style="margin-left: 8px; background: #8e44ad"
            title="現在の内容をURLに埋め込んで共有用リンクをコピー"
          >
            共有リンクをコピー
          </button>
          <input
            id="import-dfsf-input"
            type="file"
            accept=".dfsf,application/json"
            style="display: none"
          />
        </div>
        <div
          class="search-bar"
          role="search"
          aria-label="フロー検索"
          style="margin: 0 2vw 12px 2vw"
        >
          <input
            id="search-query"
            type="text"
            placeholder="検索（Alt+F）"
            aria-label="検索語"
          />
          <button
            id="search-prev"
            class="search-btn"
            title="前へ (Shift+Enter)"
          >
            ↑
          </button>
          <button id="search-next" class="search-btn" title="次へ (Enter)">
            ↓
          </button>
          <span id="search-status" class="search-status" aria-live="polite"
            >0/0</span
          >
          <button id="search-clear" class="search-btn" title="クリア">✕</button>
        </div>
        <div class="switch-wrap">
          <button id="switch-to-affirmative" class="switch-btn active">
            肯定側フロー
          </button>
          <button id="switch-to-negative" class="switch-btn">
            否定側フロー
          </button>
        </div>
      </header>
      <div class="sheet-info">
        <div class="sheet-info-row">
          <label
            >論題：<input
              type="text"
              class="sheet-topic"
              placeholder="論題を入力"
          /></label>
          <label>年月日：<input type="date" class="sheet-date" /></label>
          <label
            >大会：<input
              type="text"
              class="sheet-tournament"
              placeholder="大会名"
          /></label>
          <label
            >会場：<input type="text" class="sheet-place" placeholder="会場"
          /></label>
          <label
            >肯定側チーム名：<input
              type="text"
              class="sheet-team-affirmative"
              placeholder="肯定側チーム名"
          /></label>
          <label
            >否定側チーム名：<input
              type="text"
              class="sheet-team-negative"
              placeholder="否定側チーム名"
          /></label>
          <div class="tools-wrap">
            <div class="transcribe-wrap" aria-label="文字起こし">
              <div class="transcribe-panel">
                <div class="transcribe-controls">
                  <button
                    id="transcribe-start"
                    class="timer-btn"
                    title="文字起こし開始"
                  >
                    🎙
                  </button>
                  <button id="transcribe-stop" class="timer-btn" title="停止">
                    ■
                  </button>
                  <button
                    id="transcribe-clear"
                    class="timer-btn"
                    title="クリア"
                  >
                    ✕
                  </button>
                  <select
                    id="transcribe-lang"
                    class="timer-select"
                    title="言語"
                  >
                    <option value="ja-JP" selected>日本語</option>
                    <option value="en-US">English</option>
                  </select>
                  <label class="timer-toggle"
                    ><input
                      type="checkbox"
                      id="transcribe-autoscroll"
                      checked
                    />自動スクロール</label
                  >
                </div>
                <div
                  id="transcribe-status"
                  class="transcribe-status"
                  aria-live="polite"
                ></div>
                <div
                  id="transcribe-text"
                  class="transcribe-area"
                  contenteditable="true"
                  spellcheck="false"
                ></div>
              </div>
            </div>
            <div class="timer-wrap" aria-label="スピーチタイマー">
              <div class="timer-panel">
                <span
                  id="timer-display"
                  class="timer-display"
                  aria-live="polite"
                  >00:00</span
                >
                <button
                  id="timer-start"
                  class="timer-btn"
                  title="開始/一時停止"
                >
                  ▶
                </button>
                <button id="timer-reset" class="timer-btn" title="リセット">
                  ⟲
                </button>
                <button
                  id="timer-beep-test"
                  class="timer-btn"
                  title="ビープ音テスト"
                  aria-label="ビープ音テスト"
                >
                  ♪
                </button>
                <select
                  id="timer-preset"
                  class="timer-select"
                  title="プリセット"
                >
                  <option value="180000">3:00</option>
                  <option value="240000">4:00</option>
                  <option value="360000" selected>6:00</option>
                  <option value="60000">1:00</option>
                  <option value="120000">2:00</option>
                </select>
                <label class="timer-toggle">
                  <input type="checkbox" id="timer-countdown" checked />
                  カウントダウン
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- 設定ボタン（右上固定） -->
      <button id="open-settings-btn" class="settings-btn" title="設定">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true"
        >
          <path
            fill="#3b5998"
            d="M12 8.5a3.5 3.5 0 1 0 0 7a3.5 3.5 0 0 0 0-7m8.94 2.94l-1.23-.71c.04-.24.06-.49.06-.73s-.02-.5-.06-.74l1.23-.71a.5.5 0 0 0 .18-.68l-1.8-3.12a.5.5 0 0 0-.64-.2l-1.23.5a6.7 6.7 0 0 0-1.26-.73l-.19-1.32a.5.5 0 0 0-.5-.42h-3.6a.5.5 0 0 0-.5.42l-.19 1.32c-.45.19-.87.42-1.26.73l-1.23-.5a.5.5 0 0 0-.64.2l-1.8 3.12a.5.5 0 0 0 .18.68l1.23.71c-.04.24-.06.49-.06.74s.02.49.06.73l-1.23.71a.5.5 0 0 0-.18.68l1.8 3.12a.5.5 0 0 0 .64.2l1.23-.5c.39.31.81.55 1.26.73l.19 1.32a.5.5 0 0 0 .5.42h3.6a.5.5 0 0 0 .5-.42l.19-1.32c.45-.18.87-.42 1.26-.73l1.23.5a.5.5 0 0 0 .64-.2l1.8-3.12a.5.5 0 0 0-.18-.68Z"
          />
        </svg>
      </button>
      <!-- テーマ切替ボタン（右上固定・ガイドの左） -->
      <button id="toggle-theme-btn" class="theme-btn" title="ダークモード切替">
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true"
        >
          <path
            fill="#3b5998"
            d="M12 2a9.99 9.99 0 0 0 0 20c5.52 0 10-4.48 10-10c0-1.33-.26-2.6-.73-3.76c-.2-.49-.84-.58-1.2-.2A6.5 6.5 0 0 1 12.96 18C9.11 18 6 14.89 6 11.04c0-3 1.93-5.55 4.6-6.45c.52-.18.61-.85.18-1.2A9.96 9.96 0 0 0 12 2Z"
          />
        </svg>
      </button>
      <!-- お問い合わせメール（右上固定・テーマの左） -->
      <button
        id="open-contact-chip"
        class="contact-chip"
        title="お問い合わせ: クリックでコピー"
        aria-label="お問い合わせメール アドレスをコピー"
      >
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true"
          style="margin-right: 6px"
        >
          <path
            fill="#3b5998"
            d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4l-8 5l-8-5V6l8 5l8-5z"
          />
        </svg>
        <span class="label">fyphensub@gmail.com</span>
      </button>
      <!-- ガイドボタン（右上固定・設定の左） -->
      <button id="open-guide-btn" class="help-btn" title="ガイド">
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true"
        >
          <path
            fill="#3b5998"
            d="M12 2a10 10 0 1 0 0 20a10 10 0 0 0 0-20m0 15.25a1.25 1.25 0 1 1 0-2.5a1.25 1.25 0 0 1 0 2.5M13.53 7.06c-.39-.39-.92-.61-1.53-.61c-1.2 0-2.2.81-2.2 1.82h1.5c0-.2.31-.32.7-.32c.19 0 .35.05.46.16c.12.12.17.28.17.45c0 .26-.12.39-.49.62c-.64.4-1.14.84-1.14 1.82V12h1.5v-.36c0-.41.12-.55.61-.88c.65-.43 1.02-.9 1.02-1.68c0-.51-.2-.97-.6-1.36Z"
          />
        </svg>
      </button>

      <!-- 設定モーダル -->
      <div id="settings-overlay" class="settings-overlay" aria-hidden="true">
        <div
          class="settings-modal"
          role="dialog"
          aria-modal="true"
          aria-labelledby="settings-title"
          tabindex="-1"
        >
          <div class="settings-modal-header">
            <h2 id="settings-title">設定</h2>
            <button
              id="close-settings-btn"
              class="modal-close"
              aria-label="閉じる"
            >
              ×
            </button>
          </div>
          <div class="settings-modal-body">
            <label class="settings-row">
              <span>フォントサイズ</span>
              <select id="setting-font-size">
                <option value="default">標準</option>
                <option value="large">大</option>
                <option value="xlarge">特大</option>
              </select>
            </label>
            <label class="settings-row">
              <span>行間</span>
              <select id="setting-line-height">
                <option value="default">標準</option>
                <option value="relaxed">少し広く</option>
                <option value="loose">広く</option>
              </select>
            </label>
            <label class="settings-row">
              <span>テーマ</span>
              <select id="setting-theme">
                <option value="system">OSに合わせる</option>
                <option value="light">ライト</option>
                <option value="dark">ダーク</option>
              </select>
            </label>
            <label class="settings-row">
              <span>カラム幅</span>
              <select id="setting-col-width-mode">
                <option value="fit">画面に合わせる</option>
                <option value="fixed">固定幅</option>
              </select>
            </label>
            <label class="settings-row" id="row-col-fixed-width">
              <span>固定幅 (px)</span>
              <input
                id="setting-col-fixed-width"
                type="number"
                min="160"
                max="800"
                step="10"
                placeholder="300"
              />
            </label>
            <label class="settings-row">
              <span>ハイライトキーワード</span>
              <input
                id="setting-highlight-keywords"
                type="text"
                placeholder="例: 重要, 反論, 証拠"
              />
            </label>
            <label class="settings-row">
              <span>大文字小文字</span>
              <label>
                <input type="checkbox" id="setting-highlight-case-sensitive" />
                区別する
              </label>
            </label>
            <label class="settings-row">
              <span>スナップ整列（矢印を直角に）</span>
              <label>
                <input type="checkbox" id="setting-snap-orth" checked /> 有効
              </label>
            </label>
            <label class="settings-row">
              <span>タイマービープ</span>
              <select id="setting-timer-beep-mode">
                <option value="repeat" selected>連続</option>
                <option value="single">1回</option>
                <option value="off">なし</option>
              </select>
            </label>
            <label class="settings-row">
              <span>ビープ音色</span>
              <select id="setting-timer-beep-wave">
                <option value="sine" selected>サイン波（やわらかい）</option>
                <option value="square">矩形波（はっきり）</option>
                <option value="triangle">三角波（明るい）</option>
                <option value="sawtooth">のこぎり波（鋭い）</option>
              </select>
            </label>
            <label class="settings-row">
              <span>ビープ周波数(Hz)</span>
              <input
                id="setting-timer-beep-freq"
                type="number"
                min="100"
                max="3000"
                step="10"
                placeholder="880"
              />
            </label>
            <label class="settings-row">
              <span>ビープ長(ms)</span>
              <input
                id="setting-timer-beep-dur"
                type="number"
                min="100"
                max="3000"
                step="10"
                placeholder="400"
              />
            </label>
            <label class="settings-row">
              <span>音量</span>
              <input
                id="setting-timer-beep-vol"
                type="range"
                min="0"
                max="100"
                step="1"
              />
            </label>
            <label class="settings-row">
              <span>連続間隔(ms)</span>
              <input
                id="setting-timer-beep-period"
                type="number"
                min="200"
                max="5000"
                step="10"
                placeholder="650"
              />
            </label>
          </div>
          <div class="settings-modal-footer">
            <button id="save-settings-btn" class="download-btn">保存</button>
          </div>
        </div>
      </div>
      <!-- ガイドモーダル -->
      <div id="guide-overlay" class="settings-overlay" aria-hidden="true">
        <div
          class="settings-modal"
          role="dialog"
          aria-modal="true"
          aria-labelledby="guide-title"
          tabindex="-1"
        >
          <div class="settings-modal-header">
            <h2 id="guide-title">ガイド</h2>
            <button
              id="close-guide-btn"
              class="modal-close"
              aria-label="閉じる"
            >
              ×
            </button>
          </div>
          <div class="settings-modal-body">
            <ul style="margin: 0 0 0 1.2em; padding: 0; line-height: 1.6">
              <li>
                ブロック右のドットをドラッグして他ブロックと接続（右クリックで矢印削除）
              </li>
              <li>空白にドロップで新規ブロックを作成して接続</li>
              <li>Alt + ↑↓←→ でブロック間を移動、Ctrl + Enter で下に追加</li>
              <li>空のブロックで Backspace/Delete で削除</li>
              <li>タイマー: ▶/⏸、⟲、プリセット、カウントダウン切替あり</li>
              <li>スコアは数字のみ。マナーは減点、合計は自動計算。</li>
              <li>フロー保存/読込: .dfsf で全情報をエクスポート/インポート</li>
              <li>フローをテキストでダウンロード（Aff/Neg 両方まとめ）</li>
              <li>フローを全削除で矢印も含めて初期化</li>
            </ul>
          </div>
          <div class="settings-modal-footer">
            <button id="close-guide-btn-footer" class="download-btn">
              閉じる
            </button>
          </div>
        </div>
      </div>
      <main>
        <section class="flow-section" id="affirmative-flow">
          <div class="arrow-svg-layer"></div>
          <div class="flow-scroll">
            <div class="flow-columns">
              <div class="flow-col" data-label="2AR">
                <div class="col-title">
                  2AR<br /><span>(肯定側第二反駁)</span>
                </div>
                <div class="flow-blocks">
                  <div class="flow-block" contenteditable="true"></div>
                </div>
                <button class="add-block-btn" type="button">＋ 論点追加</button>
              </div>
              <div class="flow-col" data-label="2NR">
                <div class="col-title">
                  2NR<br /><span>(否定側第二反駁)</span>
                </div>
                <div class="flow-blocks">
                  <div class="flow-block" contenteditable="true"></div>
                </div>
                <button class="add-block-btn" type="button">＋ 論点追加</button>
              </div>
              <div class="flow-col" data-label="1AR">
                <div class="col-title">
                  1AR<br /><span>(肯定側第一反駁)</span>
                </div>
                <div class="flow-blocks">
                  <div class="flow-block" contenteditable="true"></div>
                </div>
                <button class="add-block-btn" type="button">＋ 論点追加</button>
              </div>
              <div class="flow-col" data-label="1NR">
                <div class="col-title">
                  1NR<br /><span>(否定側第一反駁)</span>
                </div>
                <div class="flow-blocks">
                  <div class="flow-block" contenteditable="true"></div>
                </div>
                <button class="add-block-btn" type="button">＋ 論点追加</button>
              </div>
              <div class="flow-col" data-label="NQ">
                <div class="col-title">NQ<br /><span>(否定側質疑)</span></div>
                <div class="flow-blocks">
                  <div class="flow-block" contenteditable="true"></div>
                </div>
                <button class="add-block-btn" type="button">＋ 論点追加</button>
              </div>
              <div class="flow-col" data-label="AC">
                <div class="col-title">AC<br /><span>(肯定側立論)</span></div>
                <div class="flow-blocks">
                  <div class="flow-block" contenteditable="true"></div>
                </div>
                <button class="add-block-btn" type="button">＋ 論点追加</button>
              </div>
            </div>
          </div>
        </section>
        <section class="flow-section" id="negative-flow" style="display: none">
          <div class="arrow-svg-layer"></div>
          <div class="flow-scroll">
            <div class="flow-columns">
              <div class="flow-col" data-label="C">
                <div class="col-title">C<br /><span>(比較・総括)</span></div>
                <div class="flow-blocks">
                  <div class="flow-block" contenteditable="true"></div>
                </div>
                <button class="add-block-btn" type="button">＋ 論点追加</button>
              </div>
              <div class="flow-col" data-label="2AR">
                <div class="col-title">
                  2AR<br /><span>(肯定側第二反駁)</span>
                </div>
                <div class="flow-blocks">
                  <div class="flow-block" contenteditable="true"></div>
                </div>
                <button class="add-block-btn" type="button">＋ 論点追加</button>
              </div>
              <div class="flow-col" data-label="2NR">
                <div class="col-title">
                  2NR<br /><span>(否定側第二反駁)</span>
                </div>
                <div class="flow-blocks">
                  <div class="flow-block" contenteditable="true"></div>
                </div>
                <button class="add-block-btn" type="button">＋ 論点追加</button>
              </div>
              <div class="flow-col" data-label="1AR">
                <div class="col-title">
                  1AR<br /><span>(肯定側第一反駁)</span>
                </div>
                <div class="flow-blocks">
                  <div class="flow-block" contenteditable="true"></div>
                </div>
                <button class="add-block-btn" type="button">＋ 論点追加</button>
              </div>
              <div class="flow-col" data-label="AQ">
                <div class="col-title">AQ<br /><span>(肯定側質疑)</span></div>
                <div class="flow-blocks">
                  <div class="flow-block" contenteditable="true"></div>
                </div>
                <button class="add-block-btn" type="button">＋ 論点追加</button>
              </div>
              <div class="flow-col" data-label="NC">
                <div class="col-title">NC<br /><span>(否定側立論)</span></div>
                <div class="flow-blocks">
                  <div class="flow-block" contenteditable="true"></div>
                </div>
                <button class="add-block-btn" type="button">＋ 論点追加</button>
              </div>
            </div>
          </div>
        </section>
        <section class="score-section">
          <table class="score-table">
            <thead>
              <tr>
                <th>役割</th>
                <th>肯定側</th>
                <th>否定側</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>立論</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
              </tr>
              <tr>
                <td>質疑</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
              </tr>
              <tr>
                <td>応答</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
              </tr>
              <tr>
                <td>第一反駁</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
              </tr>
              <tr>
                <td>第二反駁</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
              </tr>
              <tr>
                <td>マナー</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
              </tr>
              <tr>
                <td>合計</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
              </tr>
              <tr>
                <td>勝敗</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
              </tr>
            </tbody>
          </table>
        </section>
      </main>
      <footer class="app-footer">
        <span
          >© <span id="copyright-year"></span> FlowSheet by
          <a href="https://github.com/Fyphen1223">Fyphen1223</a>.
          お問い合わせは右上のメールから。</span
        >
      </footer>
    </div>
    <script src="main.js"></script>
  </body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NWV7XMCM"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
</html>
